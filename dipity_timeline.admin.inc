<?php

/**
 * Implements hook_menu().
 */
function dipity_timeline_admin_settings() {
  $form = array();
  $form['fieldset'] = array(
    '#type' => 'fieldset',
    '#title' => t('API Settings'),
    '#description' => t('To make calls to the Dipity API, you need to get an 
application key. This enables Dipity to authenticate the application without 
embedding any user credentials in a request.<br />Go to the !link page to find 
out how that works.', array('!link' => l('Dipity Developer', 'http://www.dipity.com/developer'))),
  );
  $form['fieldset']['dipity_timeline_api_key'] = array(
    '#type' => 'textfield',
    '#title' => t('API Key'),
    '#default_value' => variable_get('dipity_timeline_api_key', ''),
    '#description' => t('The <em>API Key</em> taken from Dipity !link page.', array('!link' => l(t('get an application key'), 'http://www.dipity.com/developer/register'))),
  );
  $form['fieldset']['dipity_timeline_api_secret'] = array(
    '#type' => 'textfield',
    '#title' => t('Secret'),
    '#default_value' => variable_get('dipity_timeline_api_secret', ''),
    '#description' => t('The <em>Secret</em> taken from Dipity !link page.', array('!link' => l(t('get an application key'), 'http://www.dipity.com/developer/register'))),
  );
  $form['fieldset']['dipity_timeline_api_signature'] = array(
    '#type' => 'textfield',
    '#title' => t('Signature'),
    '#description' => t('The signature is autogenerated based on the above settings.'),
    '#default_value' => variable_get('dipity_timeline_api_signature', ''),
    '#disabled' => TRUE,
  );
  return system_settings_form($form);
}

/**
 *
 */
function dipity_timeline_admin_settings_validate($form, &$form_state) {
  $api_key = $form_state['values']['dipity_timeline_api_key'];
  $api_secret = $form_state['values']['dipity_timeline_api_secret'];
  $form_state['values']['dipity_timeline_api_signature'] = dipity_timeline_secret_generate($api_key, $api_secret);
}